!function(){function t(r){var e=r.match(/(\[([^\]]+)\]|.)/g),n=[];for(var a in e)if(1===e[a].length)Glyphs[e[a]]?n.push(Glyphs[e[a]]):Diacritics[e[a]]?n[n.length-1]=apply_features(n[n.length-1],t(Diacritics[e[a]])):n.push(e[a]);else{var i=[],s=e[a].slice(1,-1).split(",");for(var o in s){var u=s[o].trim().match(/^(\+|\-)?\s?(.+)/);FeatureAliases[u[2]]&&(u[2]=FeatureAliases[u[2]]),-1!=Features.indexOf(u[2])?i[Features.indexOf(u[2])]="-"==u[1]?-1:1:console.log("Unknown feature ignored:",u[2])}n.push(i)}return n}function r(t,r){if("string"==typeof t)return t;"number"==typeof t[0]&&(t=[t]);var e=[];for(var n in t){var a=!1,i=[];if(r)for(var s in Glyphs){var o=!0;for(var u in Features)if(t[n][u]!=Glyphs[s][u]){o=!1;break}if(o){e.push(s),a=!0;break}}if(!a){for(var u in Features)t[n][u]&&i.push((-1==t[n][u]?"-":"+")+Features[u]);e.push("["+i.join(", ")+"]")}}return e.join("")}function e(t,r){var e=[];for(var n in Features)e[n]="undefined"!=typeof r[n]?r[n]:"undefined"!=typeof t[n]?t[n]:0;return e}function n(t,r){for(var e in r)if(t[e]!=r[e])return!1;return!0}function a(a,i,s,o){this.target=a||"",this.transform=i||"",this.environment=s||"",this.name=o||"",this.apply_to=function(a){if(!(this.target&&this.transform&&this.environment))return a;var i=[],s="string"==typeof this.target?t(this.target):this.target,o="string"==typeof this.transform?t(this.transform):this.transform,u="string"==typeof this.environment?t(this.environment):this.environment,l=!1,p=t(a);"#"==u[0]&&(u.shift(),l=!0);var h=u.indexOf("_");for(var f in s)u.splice(h-(1>f?0:1),1>f?1:0,s[f]);for(var f in p){var v=!0;for(var c in u){var d=parseInt(f)+parseInt(c);if(0!==parseInt(u[c])&&("#"!=u[c]||p[d]&&" "!=p[d])&&(!p[d]||!n(p[d],u[c]))){v=!1;break}}if(v&&i.push(parseInt(f)),l)break}for(var f in i)for(var c=0;c<o.length;c++){var d=i[f]+h+c;"0"==o[c]?p[d]="":"0"==s[c]?p.splice(d,0,o[c]):p[d]=e(p[d],o[c])}for(var f in p){var m=r(p[f],!0);m.length>1&&console.log(p[f]),p[f]=r(p[f],!0)}return p.join("")}}function i(){var t=[],r=[];r.push("<th>Underlying Representation:</th>");for(var e in s)r.push('<th data-i="'+e+'"><input class="datum ipa" value='+s[e]+"></th>");t.push("<tr>"+r.join("")+"</tr>");var n=[];for(var e in o){r=[];var a="";0!=e&&(a+='<button data-action="rule_up" data-i="'+e+'">up</button>'),e!=o.length-1&&(a+='<button data-action="rule_down" data-i="'+e+'">down</button>'),r.push('<td class="rule" data-i="'+e+'">'+a+'                <input class="rule_name ipa" type="text" value="'+o[e].name+'" placeholder="new rule">                <input class="rule_target ipa" type="text" value="'+o[e].target+'" placeholder="target"><span class="arrow">&rarr;</span><input class="rule_transform ipa" type="text" value="'+o[e].transform+'" placeholder="transform">                <hr>                <input class="rule_environment ipa" type="text" value="'+o[e].environment+'" placeholder="environment">            </td>');for(var i in s){n[i]||(n[i]=s[i]);var u=o[e].apply_to(n[i]);u==n[i]?r.push("<td>-</td>"):r.push("<td>"+u+"</td>"),n[i]=u}t.push('<tr class="'+(e%2?"odd":"even")+'">'+r.join("")+"</td>")}r=["<th>Surface Representation:</th>"];for(var e in n)r.push("<td>"+n[e]+"</td>");t.push("<tr>"+r.join("")+"</tr>"),$(".rules").html("<table>"+t.join("")+"</table>"),$(".rules .ipa").ipa_ime()}var s=[],o=[];$(".data.proto").clone(),$(".rule.proto").clone(),$(".rules").bind("change","input",function(t){var r=$(t.target),e=r.parent().data("i"),n=r.val(),u=!1;r.hasClass("datum")?s[e]!=n&&(e===s.length-1&&s.push(""),s[e]=n,u=!0):(r.hasClass("rule_name")&&o[e].name!=n?(o[e].name=n,u=!0):r.hasClass("rule_target")&&o[e].target!=n?(o[e].target=n,u=!0):r.hasClass("rule_transform")&&o[e].transform!=n?(o[e].transform=n,u=!0):r.hasClass("rule_environment")&&o[e].environment!=n&&(o[e].environment=n,u=!0),u&&e===o.length-1&&o.push(new a)),u&&i()}),$(".rules").bind("click","button",function(t){if(console.log(t),"BUTTON"==t.target.nodeName){var r=$(t.target).data("action"),e=$(t.target).data("i"),n=o[e];"rule_up"==r?(o[e]=o[e-1],o[e-1]=n):"rule_down"==r&&(o[e]=o[e+1],o[e+1]=n),i()}}),s.push("bitiɑso"),s.push("bɑtiɑso"),s.push("");var u=new a("C","[-v]","#_","Initial devoicing"),l=new a("C","[+voiced]","V_V","Intervocalic voicing"),p=new a;o.push(u),o.push(l),o.push(p),i()}();